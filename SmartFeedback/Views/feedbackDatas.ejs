<!DOCTYPE html>
<html>
    <head>
        <title>Users</title>
        <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <style>
            table { border-collapse:collapse; width: 80%; margin: 20px auto; }
            th,td { border:1px solid #ccc; padding:8px; text-align: center; }
            th { background-color: #007bff; color: white ;}
            caption { font-size: 1.5em; margin-bottom: 10px;}
        </style>
    </head>
    <body>

        <table>
            <caption>Feedback detiails</caption>
            <tr>
                <th>Feedback Id</th>
                <th>User Id</th>
                <th>Message</th>
                <th>Sentiment</th>
                <th>Time Stamp</th>
                <th>Action</th>
            </tr>
            <% for(result of results) { %>
                <tr id="row-<%= result.feedbackId %>">
                    <td><%= result.feedbackId %></td>
                    <td><%= result.userId %></td>
                    <td><%= result.message %></td>
                    <td><%= result.sentiment %></td>
                    <td><%= result.timestamp.toString().split(" ").slice(0,5).join(" ") %></td>
                    <td>
                        <button onclick="deleteFeedback('<%= result.feedbackId %>')" style="background-color: green; color: white; border-radius: 5px; cursor: pointer;">Delete</button>
                    </td>
                </tr>

                <% } %>
        </table>

    <script>

        function deleteFeedback(id){
            if(!confirm("Are you sure you want to delete this feedback?")) return;

            fetch(`/admin/feedbackData/${id}`, { method: 'DELETE' })
                .then(res => res.json())
                .then(data => {
                    if(data.success){
                        // Remove the deleted row from table
                        const row = document.getElementById(`row-${id}`);
                        if(row) row.remove();

                        // Optionally, update charts here via AJAX if needed
                    } 
                    fetch("/admin/feedbackData/json")
                    .then(res => res.json())
                    .then(updatedResults => {});
                });
        }
    </script>
</body>
</html>