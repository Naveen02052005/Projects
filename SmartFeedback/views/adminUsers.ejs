<!DOCTYPE html>
<html>
    <head>
        <title>Users</title>
        <style>
            table { border-collapse:collapse; width: 80%; margin: 20px auto; }
            th,td { border:1px solid #ccc; padding:8px; text-align: center; }
            th { background-color: #007bff; color: white ;}
            caption { font-size: 1.5em; margin-bottom: 10px;}
        </style>
    </head>
    <body>
        <table>
            <caption>User Details</caption>
            <tr>
                <th>Id</th>
                <th>UserName</th>
                <th>Email</th>
                <th>Edit User Details</th>
                <th>Delete User</th>
            </tr>
            <% for(user of users) { %>
            <tr id="row-<%= user.id %>">
                <td><%= user.id %></td>
                <td><%= user.userName %></td>
                <td><%= user.email %></td>
                <td>
                    <a href="/admin/users/<%= user.id %>/edit"><button style="background-color: green;font-size: 1.0rem; color: white; border-radius: 5px; cursor: pointer; width: 80px; height: 30px;">Edit</button></a>
                </td>
                <td>
                    <button onclick="deleteUser('<%= user.id %>')" style="background-color: red;font-size: 1.0rem; color: white; border-radius: 5px; cursor: pointer; width: 80px; height: 30px;">Delete</button>
                </td>
            </tr>
            <% } %>
        </table>
        <script>
            function deleteUser(id)
            {
                if(!confirm("Are you sure you want to delete this User ?")) return;

                fetch(`/admin/users/${id}`,{method: 'DELETE'})
                .then(res => res.json())
                .then(data => {
                    if(data.success){
                        const row = document.getElementById(`row-${id}`);
                        if(row) row.remove();
                        updateDashboardCharts();
                        alert("User deleted Successfully!")
                    }
                    else{
                        alert("Failed to delete user!")
                    }
                    
                })
                .catch(err => console.assert(err));
                
            }
        </script>
    </body>
</html>